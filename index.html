<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #000; color: #fff; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        
        .game-container {
            max-width: 800px;
            width: 100%;
            display: grid;
            grid-template-areas:
                "header header header"
                "enemy enemy enemy"
                "buffs null controls"
                "player player player"
                "interface interface interface";
            grid-template-columns: 1fr 1fr 200px;
            grid-template-rows: auto auto 1fr auto auto;
            gap: 20px;
            align-items: center;
        }
        
        .header {grid-area: header;text-align: center;font-size: 18px;flex-flow: row;font-weight: bold;color: #ffd700;}
        .monster-info { font-size: 14px; color: #ccc; margin-top: 5px; }
        
        .enemy-section { grid-area: enemy; text-align: center; }
        .buffs-area { grid-area: buffs; text-align: center; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); min-height: 120px; }
        .player-section { grid-area: player; text-align: center; }
        .game-interface { grid-area: interface; }
        .controls { grid-area: controls; display: flex; flex-direction: column; gap: 10px; }
        
        .health-bar { display: flex; justify-content: center; gap: 4px; margin: 10px 0; }
        .health-point { width: 24px; height: 24px; border-radius: 4px; background: #ff4444; box-shadow: 0 0 4px rgba(255, 68, 68, 0.3); }
        .health-point.health-empty { background: #444; border: 1px solid #666; }
        
        .choice-wheel { width: 120px; height: 120px; position: relative; margin: 0 auto; }
        .center-emoji { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 108px; z-index: 10; }
        .choice-arms { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(25deg); transition: transform 0.5s ease; }
        .choice-arm { position: absolute; width: 90px; height: 2px; background: #666; transform-origin: 0 center; }
        .choice-arm::after { content: attr(data-emoji); position: absolute; right: -15px; top: -15px; text-align: center; transform: translate(0%, -17%) rotate(90deg); font-size: 50px; }
        .choice-arm:nth-child(1) { transform: rotate(0deg); }
        .choice-arm:nth-child(2) { transform: rotate(120deg); }
        .choice-arm:nth-child(3) { transform: rotate(240deg); }
        .choice-arms.selected-rock { transform: translate(-50%, -50%) rotate(-90deg); }
        .choice-arms.selected-paper { transform: translate(-50%, -50%) rotate(150deg); }
        .choice-arms.selected-scissors { transform: translate(-50%, -50%) rotate(30deg); }
        .enemy-wheel .choice-arms.selected-rock { transform: translate(-50%, -50%) rotate(90deg); }
        .enemy-wheel .choice-arms.selected-paper { transform: translate(-50%, -50%) rotate(-30deg); }
        .enemy-wheel .choice-arms.selected-scissors { transform: translate(-50%, -50%) rotate(-150deg); }
        
        .buff-title { font-size: 14px; font-weight: bold; color: #ffd700; margin-bottom: 10px; }
        .buff-desc { font-size: 12px; color: #ccc; margin-bottom: 15px; }
        .active-buffs { display: flex; justify-content: center; gap: 6px; flex-wrap: wrap; }
        .active-buff { background: rgba(255, 215, 0, 0.15); border: 1px solid #ffd700; border-radius: 4px; padding: 4px 8px; font-size: 12px; display: flex; align-items: center; gap: 4px; }
        .buff-name { color: #ffd700; font-weight: bold; }
        .buff-duration { background: #ffd700; color: #000; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        
        .choices-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .choice-btn { padding: 4px; background: linear-gradient(145deg, #666, #555); border: none; border-radius: 8px; color: white; font-size: 24px; cursor: pointer; transition: all 0.3s ease; }
        .choice-btn:hover { background: linear-gradient(145deg, #777, #666); transform: translateY(-2px); }
        .choice-btn.selected { background: linear-gradient(145deg, #ffd700, #e6c200); color: #000; box-shadow: 0 0 0 2px white; transform: translateY(-2px); }
        .choice-btn:disabled { background: linear-gradient(145deg, #333, #222); opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .buffs-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; }
        .buff-btn, .no-buff-btn { padding: 12px 6px; border: none; border-radius: 6px; font-size: 10px; font-weight: bold; color: #000; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; }
        .buff-btn:hover, .no-buff-btn:hover { opacity: 0.85; transform: translateY(-1px); }
        .buff-btn.selected, .no-buff-btn.selected { box-shadow: 0 0 0 2px white; transform: translateY(-2px); }
        .no-buff-btn { background: linear-gradient(145deg, #555, #444); color: white; }
        .buff-btn[data-buff="block"] { background: linear-gradient(145deg, #ff6b6b, #e55555); }
        .buff-btn[data-buff="tie_damage"] { background: linear-gradient(145deg, #4dabf7, #339af0); }
        .buff-btn[data-buff="chaos"] { background: linear-gradient(145deg, #69db7c, #51cf66); }
        .buff-btn[data-buff="double"] { background: linear-gradient(145deg, #ffd43b, #fab005); }
        .buff-btn[data-buff="counter"] { background: linear-gradient(145deg, #da77f2, #cc5de8); }
        .buff-btn[data-buff="shield"] { background: linear-gradient(145deg, #74c0fc, #339af0); }
        .buff-btn[data-buff="rage"] { background: linear-gradient(145deg, #f06292, #e91e63); }
        .buff-btn[data-buff="freeze"] { background: linear-gradient(145deg, #80deea, #4dd0e1); }
        .buff-btn[data-buff="heal"] { background: linear-gradient(145deg, #a5d6a7, #81c784); }
        
        .control-btn { width: 100%; padding: 15px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; font-size: 14px; }
        .make-move-btn { background: linear-gradient(145deg, #4dabf7, #339af0); }
        .next-round-btn { background: linear-gradient(145deg, #51cf66, #40c057); }
        .make-move-btn:hover, .control-btn:hover { transform: translateY(-2px); }
        .make-move-btn:disabled { background: linear-gradient(145deg, #444, #333); opacity: 0.5; cursor: not-allowed; transform: none; }
        .controls .control-btn:not(.active) { opacity: 0.3; pointer-events: none; }
        
        .popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.9); color: #ffd700; padding: 15px 25px; border-radius: 8px; border: 2px solid #ffd700; font-weight: bold; z-index: 1000; animation: fadeInOut 2.5s ease-in-out; text-align: center; }
        .victory-popup { background: linear-gradient(145deg, rgba(81, 207, 102, 0.95), rgba(64, 192, 87, 0.95)); color: white; padding: 20px 30px; border: 3px solid #51cf66; animation: victoryPulse 3s ease-in-out; }
        .defeat-popup { background: linear-gradient(145deg, rgba(255, 68, 68, 0.95), rgba(229, 85, 85, 0.95)); color: white; padding: 20px 30px; border: 3px solid #ff4444; }
        .popup-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .popup-text { font-size: 14px; margin-bottom: 15px; }
        .popup-btn { padding: 10px 20px; background: #4dabf7; border: none; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; }
        
        .hidden { display: none !important; }
        
        @keyframes fadeInOut { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } 30% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 70% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } }
        @keyframes victoryPulse { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); } 20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); } 40% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 60% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); } 80% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } }
        
        @media (max-width: 768px) {
            .game-container { 
                /* grid-template-areas: 
                    "header"
                    "enemy"
                    "buffs"
                    "player"
                    "interface"
                    "controls"; */
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto auto auto;
            }
            .controls { flex-direction: row; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            –†–ê–£–ù–î <span id="round-number">1</span>
            <div class="monster-info">
                <span id="monster-emoji">üëπ</span>
                <span id="monster-name">–ì–æ–±–ª–∏–Ω</span>
            </div>
        </div>
        
        <div class="enemy-section">
            <div class="health-bar" id="enemy-health"></div>
            <div class="choice-wheel enemy-wheel">
                <div class="center-emoji" id="enemy-center">üëπ</div>
                <div class="choice-arms" id="enemy-arms">
                    <div class="choice-arm" data-emoji="‚úä"></div>
                    <div class="choice-arm" data-emoji="‚úã"></div>
                    <div class="choice-arm" data-emoji="‚úåÔ∏è"></div>
                </div>
            </div>
        </div>
        
        <div class="buffs-area">
            <div class="buff-title" id="buff-title">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–∏–ª–µ–Ω–∏–µ</div>
            <div class="buff-desc" id="buff-desc"></div>
            <div class="active-buffs" id="active-buffs"></div>
        </div>
        
        <div class="player-section">
            <div class="choice-wheel">
                <div class="center-emoji">üåû</div>
                <div class="choice-arms" id="player-arms">
                    <div class="choice-arm" data-emoji="‚úä"></div>
                    <div class="choice-arm" data-emoji="‚úã"></div>
                    <div class="choice-arm" data-emoji="‚úåÔ∏è"></div>
                </div>
            </div>
            <div class="health-bar" id="player-health"></div>
        </div>
        
        <div class="game-interface" id="game-interface">
            <div class="choices-grid">
                <button class="choice-btn" data-choice="rock">‚úä</button>
                <button class="choice-btn" data-choice="paper">‚úã</button>
                <button class="choice-btn" data-choice="scissors">‚úåÔ∏è</button>
            </div>
            <div class="buffs-grid" id="buffs-grid"></div>
        </div>
        
        <div class="controls">
            <button class="control-btn make-move-btn" id="make-move-btn" disabled>–°–î–ï–õ–ê–¢–¨ –•–û–î</button>
        </div>
    </div>

    <script>
        const CONFIG = {
            MAX_HEALTH: 10,
            CHOICES: ['rock', 'paper', 'scissors'],
            CHOICE_EMOJIS: { rock: '‚úä', paper: '‚úã', scissors: '‚úåÔ∏è' },
            CHOICE_NAMES: { rock: '–ö–∞–º–µ–Ω—å', paper: '–ë—É–º–∞–≥–∞', scissors: '–ù–æ–∂–Ω–∏—Ü—ã' },
            PROGRESSION: { PLAYER_BASE_HEALTH: 3, ENEMY_BASE_HEALTH: 1, PLAYER_HEALTH_INCREMENT: 0.5, ENEMY_HEALTH_INCREMENT: 1 },
            MONSTERS: [
                { name: '–ì–æ–±–ª–∏–Ω', emoji: 'üëπ' }, { name: '–û—Ä–∫', emoji: 'üßå' }, { name: '–°–∫–µ–ª–µ—Ç', emoji: 'üíÄ' }, { name: '–î—Ä–∞–∫–æ–Ω', emoji: 'üêâ' }, { name: '–î–µ–º–æ–Ω', emoji: 'üòà' },
                { name: '–¢—Ä–æ–ª–ª—å', emoji: 'üßü' }, { name: '–í–∞–º–ø–∏—Ä', emoji: 'üßõ' }, { name: '–ó–æ–º–±–∏', emoji: 'üßü&zwj;‚ôÇÔ∏è' }, { name: '–í–∞—Å–∏–ª–∏—Å–∫', emoji: 'üêç' }, { name: '–ú–∏–Ω–æ—Ç–∞–≤—Ä', emoji: 'üêÇ' }
            ]
        };

        const BUFFS = {
            block: { name: '–ë–ª–æ–∫', description: '–ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ.', duration: 1, blocksEnemyChoice: true, unlockRound: 1 },
            tie_damage: { name: '–ù–∏—á—å—è+', description: '–ü—Ä–∏ –Ω–∏—á–µ–π–Ω–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã –Ω–∞–Ω–æ—Å–∏—Ç–µ 1 —É—Ä–æ–Ω –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É.', duration: 2, tieDamageToEnemy: 1, unlockRound: 1 },
            chaos: { name: '–•–∞–æ—Å', description: '–†–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä—ã –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω.', duration: 1, randomizesChoices: true, unlockRound: 2 },
            double: { name: 'x2', description: '–ü—Ä–∏ –ø–æ–±–µ–¥–µ –Ω–∞–Ω–æ—Å–∏—Ç–µ –¥–≤–æ–π–Ω–æ–π —É—Ä–æ–Ω (2 –≤–º–µ—Å—Ç–æ 1).', duration: 3, winDamageMultiplier: 2, unlockRound: 3 },
            counter: { name: '–ö–æ–Ω—Ç—Ä', description: '–ü—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∞–Ω–æ—Å–∏—Ç–µ 1 —É—Ä–æ–Ω –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É.', duration: 2, loseDamageToEnemy: 1, unlockRound: 2 },
            shield: { name: '–©–∏—Ç', description: '–£–º–µ–Ω—å—à–∞–µ—Ç –ø–æ–ª—É—á–∞–µ–º—ã–π —É—Ä–æ–Ω –Ω–∞ 1 (–º–∏–Ω–∏–º—É–º 0).', duration: 3, damageReduction: 1, unlockRound: 4 },
            rage: { name: '–Ø—Ä–æ—Å—Ç—å', description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–Ω–æ—Å–∏–º—ã–π —É—Ä–æ–Ω –Ω–∞ 1.', duration: 2, damageBonus: 1, unlockRound: 3 },
            freeze: { name: '–ó–∞–º–æ—Ä–æ–∑–∫–∞', description: '–í—Ä–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥.', duration: 1, freezesEnemy: true, unlockRound: 5 },
            heal: { name: '–ò—Å—Ü–µ–ª–µ–Ω–∏–µ', description: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1 –∑–¥–æ—Ä–æ–≤—å–µ.', duration: 1, healAmount: 1, unlockRound: 6 }
        };

        class Game {
            constructor() {
                this.reset();
                this.init();
            }

            reset() {
                this.round = 1;
                this.playerChoice = null;
                this.playerBuff = null;
                this.playerActiveBuffs = [];
                this.enemyChoice = null;
                this.blockedChoices = [];
                this.phase = 'selecting';
                this.updateHealthForRound();
                this.currentMonster = CONFIG.MONSTERS[(this.round - 1) % CONFIG.MONSTERS.length];
                this.availableBuffs = Object.values(BUFFS).filter(b => b.unlockRound <= this.round);
            }

            updateHealthForRound() {
                this.playerMaxHealth = Math.round(CONFIG.PROGRESSION.PLAYER_BASE_HEALTH + (this.round - 1) * CONFIG.PROGRESSION.PLAYER_HEALTH_INCREMENT);
                this.enemyMaxHealth = CONFIG.PROGRESSION.ENEMY_BASE_HEALTH + (this.round - 1) * CONFIG.PROGRESSION.ENEMY_HEALTH_INCREMENT;
                if (this.playerHealth === undefined) this.playerHealth = this.playerMaxHealth;
                this.enemyHealth = this.enemyMaxHealth;
                this.currentMonster = CONFIG.MONSTERS[(this.round - 1) % CONFIG.MONSTERS.length];
            }

            init() {
                this.setupEventListeners();
                this.updateDisplay();
                setTimeout(() => this.showNotification(`${this.currentMonster.emoji} ${this.currentMonster.name} - –í–∞—à–µ ‚ù§Ô∏è: ${this.playerHealth}/${this.playerMaxHealth}, –í—Ä–∞–≥ ‚ù§Ô∏è: ${this.enemyMaxHealth}`), 500);
            }

            setupEventListeners() {
                document.querySelectorAll('.choice-btn').forEach(btn => btn.addEventListener('click', (e) => this.handleChoiceSelection(e)));
                document.getElementById('make-move-btn').addEventListener('click', () => this.makeMove());
            }

            handleChoiceSelection(e) {
                const choice = e.target.dataset.choice;
                if (this.blockedChoices.includes(choice)) return;
                document.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('selected'));
                if (this.playerChoice === choice) {
                    this.playerChoice = null;
                } else {
                    this.playerChoice = choice;
                    e.target.classList.add('selected');
                }
                this.updateDisplay();
            }

            handleBuffSelection(e) {
                if (e.target.classList.contains('no-buff-btn')) {
                    document.querySelectorAll('.buff-btn, .no-buff-btn').forEach(b => b.classList.remove('selected'));
                    this.playerBuff = null;
                    this.clearBuffInfo();
                    e.target.classList.add('selected');
                    return;
                }
                const buffType = e.target.dataset.buff;
                if (!buffType) return;
                document.querySelectorAll('.buff-btn, .no-buff-btn').forEach(b => b.classList.remove('selected'));
                if (this.playerBuff === buffType) {
                    this.playerBuff = null;
                    this.clearBuffInfo();
                } else {
                    this.playerBuff = buffType;
                    e.target.classList.add('selected');
                    this.showBuffInfo(buffType);
                }
            }

            showBuffInfo(buffType) {
                const buff = BUFFS[buffType];
                if (!buff) return;
                document.getElementById('buff-title').textContent = `${buff.name} (${buff.duration} —Ö–æ–¥–æ–≤)`;
                document.getElementById('buff-desc').textContent = buff.description;
            }

            clearBuffInfo() {
                document.getElementById('buff-title').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–∏–ª–µ–Ω–∏–µ';
                document.getElementById('buff-desc').textContent = '';
            }

            rotateArms(isPlayer, choice) {
                const armsId = isPlayer ? 'player-arms' : 'enemy-arms';
                const arms = document.getElementById(armsId);
                if (!choice) {
                    arms.className = 'choice-arms';
                    return;
                }
                arms.className = `choice-arms selected-${choice}`;
            }

            makeMove() {
                if (this.playerBuff) {
                    this.addBuff(this.playerBuff);
                    this.playerBuff = null;
                }
                this.phase = 'reveal';
                this.updateDisplay();
                setTimeout(() => {
                    this.generateEnemyMove();
                    this.updateDisplay();
                    setTimeout(() => this.resolveRound(), 500);
                }, 2000);
            }

            generateEnemyMove() {
                this.enemyChoice = CONFIG.CHOICES[Math.floor(Math.random() * CONFIG.CHOICES.length)];
            }

            addBuff(buffType) {
                const buff = BUFFS[buffType];
                if (!buff) return;
                const existingIndex = this.playerActiveBuffs.findIndex(b => b.type === buffType);
                if (existingIndex >= 0) {
                    this.playerActiveBuffs[existingIndex].duration = buff.duration;
                } else {
                    this.playerActiveBuffs.push({ type: buffType, name: buff.name, duration: buff.duration, ...buff });
                }
            }

            decreaseBuffDurations() {
                this.playerActiveBuffs = this.playerActiveBuffs.filter(buff => {
                    buff.duration--;
                    return buff.duration > 0;
                });
            }

            getBuffModifier(property) {
                return this.playerActiveBuffs.reduce((sum, buff) => sum + (buff[property] || 0), 0);
            }

            hasBuffProperty(property) {
                return this.playerActiveBuffs.some(buff => buff[property]);
            }

            resolveRound() {
                let finalPlayerChoice = this.playerChoice, finalEnemyChoice = this.enemyChoice, messages = [];
                
                if (this.hasBuffProperty('blocksEnemyChoice')) {
                    const blockedChoice = CONFIG.CHOICES[Math.floor(Math.random() * CONFIG.CHOICES.length)];
                    if (finalEnemyChoice === blockedChoice) {
                        const availableChoices = CONFIG.CHOICES.filter(choice => choice !== blockedChoice);
                        finalEnemyChoice = availableChoices[Math.floor(Math.random() * availableChoices.length)];
                        messages.push(`–ë–ª–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª ${CONFIG.CHOICE_NAMES[blockedChoice]}!`);
                    }
                }
                
                if (this.hasBuffProperty('randomizesChoices')) {
                    finalPlayerChoice = CONFIG.CHOICES[Math.floor(Math.random() * CONFIG.CHOICES.length)];
                    finalEnemyChoice = CONFIG.CHOICES[Math.floor(Math.random() * CONFIG.CHOICES.length)];
                    messages.push('–•–∞–æ—Å –∏–∑–º–µ–Ω–∏–ª –≤—ã–±–æ—Ä—ã!');
                }

                if (this.hasBuffProperty('freezesEnemy')) {
                    finalEnemyChoice = 'rock';
                    messages.push('–í—Ä–∞–≥ –∑–∞–º–æ—Ä–æ–∂–µ–Ω!');
                }

                const winner = this.getWinner(finalPlayerChoice, finalEnemyChoice);
                let playerDamage = 0, enemyDamage = 0;

                if (winner === 'tie') {
                    messages.push('–ù–∏—á—å—è!');
                    enemyDamage += this.getBuffModifier('tieDamageToEnemy');
                    if (this.getBuffModifier('tieDamageToEnemy') > 0) messages.push('–ù–∏—á—å—è+ –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω!');
                } else if (winner === 'player') {
                    messages.push('–í—ã –ø–æ–±–µ–¥–∏–ª–∏!');
                    let winDamage = 1;
                    const winMultiplier = this.getBuffModifier('winDamageMultiplier');
                    if (winMultiplier > 0) {
                        winDamage = winMultiplier;
                        messages.push('–î–≤–æ–π–Ω–æ–π —É—Ä–æ–Ω!');
                    }
                    winDamage += this.getBuffModifier('damageBonus');
                    if (this.getBuffModifier('damageBonus') > 0) messages.push('–Ø—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω!');
                    enemyDamage += winDamage;
                } else {
                    messages.push('–í—Ä–∞–≥ –ø–æ–±–µ–¥–∏–ª!');
                    playerDamage += 1;
                    enemyDamage += this.getBuffModifier('loseDamageToEnemy');
                    if (this.getBuffModifier('loseDamageToEnemy') > 0) messages.push('–ö–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞!');
                }

                if (playerDamage > 0) {
                    const reduction = this.getBuffModifier('damageReduction');
                    if (reduction > 0) {
                        playerDamage = Math.max(0, playerDamage - reduction);
                        messages.push('–©–∏—Ç –∑–∞—â–∏—Ç–∏–ª!');
                    }
                }

                this.playerHealth = Math.max(0, this.playerHealth - playerDamage);
                this.enemyHealth = Math.max(0, this.enemyHealth - enemyDamage);

                const healAmount = this.getBuffModifier('healAmount');
                if (healAmount > 0) {
                    this.playerHealth = Math.min(this.playerMaxHealth, this.playerHealth + healAmount);
                    messages.push(`–ò—Å—Ü–µ–ª–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–æ ${healAmount} –∑–¥–æ—Ä–æ–≤—å—è!`);
                }

                this.phase = 'result';
                this.updateDisplay();
                
                if (this.playerHealth <= 0) {
                    this.showDefeatPopup();
                } else if (this.enemyHealth <= 0) {
                    this.showVictoryPopup();
                } else {
                    this.showResultPopup(messages.join(' '));
                }
            }

            getWinner(choice1, choice2) {
                if (choice1 === choice2) return 'tie';
                const winConditions = { rock: 'scissors', paper: 'rock', scissors: 'paper' };
                return winConditions[choice1] === choice2 ? 'player' : 'enemy';
            }

            showResultPopup(message) {
                this.showNotification(message);
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => this.nextRound(), 3000);
            }

            showVictoryPopup() {
                this.showVictoryNotification(`üèÜ ${this.currentMonster.emoji} ${this.currentMonster.name} –ü–û–ë–ï–ñ–î–ï–ù!`, '–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É...');
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => this.nextRound(), 3000);
            }

            showDefeatPopup() {
                const popup = document.createElement('div');
                popup.className = 'popup defeat-popup';
                popup.innerHTML = `
                    <div class="popup-title">–ü–û–†–ê–ñ–ï–ù–ò–ï</div>
                    <div class="popup-text">–í–∞—Å –ø–æ–±–µ–¥–∏–ª ${this.currentMonster.emoji} ${this.currentMonster.name} –Ω–∞ —Ä–∞—É–Ω–¥–µ ${this.round}</div>
                    <button class="popup-btn" onclick="location.reload()">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
                `;
                document.body.appendChild(popup);
            }

            nextRound() {
                if (this.enemyHealth <= 0) {
                    this.decreaseBuffDurations();
                    this.round++;
                    this.updateHealthForRound();
                    this.availableBuffs = Object.values(BUFFS).filter(b => b.unlockRound <= this.round);
                    setTimeout(() => {
                        this.showNotification(`${this.currentMonster.emoji} ${this.currentMonster.name} - –í–∞—à–µ ‚ù§Ô∏è: ${this.playerHealth}/${this.playerMaxHealth}, –í—Ä–∞–≥ ‚ù§Ô∏è: ${this.enemyMaxHealth}`);
                    }, 300);
                } else {
                    this.decreaseBuffDurations();
                }
                
                this.phase = 'selecting';
                this.playerChoice = null;
                this.playerBuff = null;
                this.enemyChoice = null;
                this.blockedChoices = [];
                
                this.clearSelections();
                this.clearBuffInfo();
                this.updateDisplay();
            }

            clearSelections() {
                document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
                document.querySelectorAll('.buff-btn, .no-buff-btn').forEach(btn => btn.classList.remove('selected'));
                this.rotateArms(true, null);
                this.rotateArms(false, null);
            }

            updateDisplay() {
                document.getElementById('round-number').textContent = this.round;
                document.getElementById('monster-emoji').textContent = this.currentMonster.emoji;
                document.getElementById('monster-name').textContent = this.currentMonster.name;
                document.getElementById('enemy-center').textContent = this.currentMonster.emoji;

                this.updateHealthBar('player-health', this.playerHealth, this.playerMaxHealth);
                this.updateHealthBar('enemy-health', this.enemyHealth, this.enemyMaxHealth);

                if (this.phase === 'selecting') {
                    this.rotateArms(true, this.playerChoice);
                    this.rotateArms(false, null);
                } else if (this.phase === 'reveal') {
                    this.rotateArms(true, this.playerChoice);
                    this.rotateArms(false, null);
                } else {
                    this.rotateArms(true, this.playerChoice);
                    this.rotateArms(false, this.enemyChoice);
                }

                this.updateActiveBuffs();
                this.updateBlockedChoices();
                this.renderBuffButtons();

                // –£–ø—Ä–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏
                const makeMoveBtn = document.getElementById('make-move-btn');
                if (this.phase === 'selecting') {
                    makeMoveBtn.disabled = !this.playerChoice;
                    makeMoveBtn.classList.add('active');
                } else {
                    makeMoveBtn.disabled = true;
                    makeMoveBtn.classList.remove('active');
                }
            }

            updateHealthBar(elementId, health, maxHealth) {
                const element = document.getElementById(elementId);
                element.innerHTML = '';
                for (let i = 0; i < maxHealth; i++) {
                    const healthPoint = document.createElement('div');
                    healthPoint.className = `health-point ${i < health ? '' : 'health-empty'}`;
                    element.appendChild(healthPoint);
                }
            }

            updateActiveBuffs() {
                const container = document.getElementById('active-buffs');
                container.innerHTML = '';
                this.playerActiveBuffs.forEach(buff => {
                    const buffElement = document.createElement('div');
                    buffElement.className = 'active-buff';
                    buffElement.innerHTML = `
                        <span class="buff-name">${buff.name}</span>
                        <span class="buff-duration">${buff.duration}</span>
                    `;
                    container.appendChild(buffElement);
                });
            }

            updateBlockedChoices() {
                document.querySelectorAll('.choice-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('blocked');
                });

                this.blockedChoices.forEach(choice => {
                    const btn = document.querySelector(`[data-choice="${choice}"]`);
                    if (btn) {
                        btn.disabled = true;
                        btn.classList.add('blocked');
                    }
                });
            }

            renderBuffButtons() {
                const buffsGrid = document.getElementById('buffs-grid');
                buffsGrid.innerHTML = '';

                this.availableBuffs.forEach(buff => {
                    const button = document.createElement('button');
                    button.className = 'buff-btn';
                    button.dataset.buff = Object.keys(BUFFS).find(key => BUFFS[key] === buff);
                    button.textContent = buff.name;

                    if (this.playerBuff === button.dataset.buff) {
                        button.classList.add('selected');
                    }

                    button.addEventListener('click', (e) => this.handleBuffSelection(e));
                    buffsGrid.appendChild(button);
                });

                if (this.availableBuffs.length > 0) {
                    const noBuff = document.createElement('button');
                    noBuff.className = 'no-buff-btn';
                    noBuff.textContent = '–ë–ï–ó –£–°–ò–õ–ï–ù–ò–Ø';
                    
                    if (this.playerBuff === null) {
                        noBuff.classList.add('selected');
                    }

                    noBuff.addEventListener('click', (e) => this.handleBuffSelection(e));
                    buffsGrid.appendChild(noBuff);
                }
            }

            showNotification(text) {
                const notification = document.createElement('div');
                notification.className = 'popup';
                notification.innerHTML = `
                    <div class="popup-title">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                    <div class="popup-text">${text}</div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }

            showVictoryNotification(title, subtitle) {
                const notification = document.createElement('div');
                notification.className = 'popup victory-popup';
                notification.innerHTML = `
                    <div class="popup-title">${title}</div>
                    <div class="popup-text">${subtitle}</div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new Game();
        });
    </script>

</body></html>